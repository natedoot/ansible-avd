{% set node_types = node_type_keys | arista.avd.convert_dicts('key') | map(attribute="type") %}
veos:
  # Define the global vEOS node parameters
  username: {{ act_veos_username }}
  password: {{ act_veos_password }}
  version: {{ veos_version }}

nodes:
{% for node in groups[fabric_name] | arista.avd.natural_sort %}
{%     set node_hostvars = hostvars[node] %}
{%     if node_hostvars.type | arista.avd.default('undefined') in node_types %}
  - {{ node }}:
      ip_addr: {{ node_hostvars.switch.mgmt_ip | ansible.utils.ipaddr('address') }}
      node_type: veos
      version: {{ veos_version }}
      neighbors:
{%         for ethernet_interface in node_hostvars.ethernet_interfaces | arista.avd.natural_sort %}
{%              if node_hostvars.ethernet_interfaces[ethernet_interface].peer_type | arista.avd.default('undefined') in node_types + ['mlag_peer'] %}
{%                 set peer = node_hostvars.ethernet_interfaces[ethernet_interface].peer %}
{%                 set peer_interface = node_hostvars.ethernet_interfaces[ethernet_interface].peer_interface %}
        - neighborDevice: {{ peer }}
          neighborPort: {{ peer_interface }}
          port: {{ ethernet_interface }}
{%              endif %}
{%          endfor %}
{%      endif %}
{% endfor %}